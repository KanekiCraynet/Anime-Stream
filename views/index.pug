extends layout

block content
  // Hero Section
  section(class="relative overflow-hidden bg-gradient-to-br from-primary-600 via-purple-600 to-indigo-700 dark:from-primary-800 dark:via-purple-800 dark:to-indigo-900")
    // Background decoration
    div(class="absolute inset-0 bg-gradient-to-r from-primary-600/20 via-purple-600/20 to-indigo-600/20")
    div(class="absolute top-0 left-0 w-full h-full")
      div(class="absolute top-20 left-10 w-72 h-72 bg-white/10 rounded-full blur-3xl animate-pulse")
      div(class="absolute bottom-20 right-10 w-96 h-96 bg-purple-400/10 rounded-full blur-3xl animate-pulse delay-1000")
      div(class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-indigo-400/10 rounded-full blur-3xl animate-pulse delay-500")
    
    div(class="container mx-auto px-4 md:px-6 lg:px-8 py-16 md:py-24 relative")
      div(class="max-w-4xl mx-auto text-center")
        div(class="mb-8")
          h1(class="text-4xl md:text-6xl lg:text-7xl font-bold text-white mb-6 leading-tight")
            span(class="block") Selamat Datang di
            span(class="block bg-gradient-to-r from-yellow-300 via-pink-300 to-purple-300 bg-clip-text text-transparent") KitaNime
          p(class="text-xl md:text-2xl text-white/90 mb-8 leading-relaxed max-w-3xl mx-auto") Platform streaming anime subtitle Indonesia terlengkap dan terbaru. Nikmati ribuan anime berkualitas tinggi dengan subtitle Indonesia yang akurat dan berkualitas.
        
        div(class="flex flex-col sm:flex-row gap-4 justify-center items-center")
          a(href="/ongoing" class="px-8 py-4 bg-white/20 backdrop-blur-sm border border-white/30 rounded-2xl text-white font-semibold hover:bg-white/30 hover:border-white/40 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1")
            span Mulai Menonton
            svg(class="w-5 h-5 ml-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24")
              path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z")
          a(href="/search" class="px-8 py-4 bg-gradient-to-r from-yellow-400 to-orange-500 text-white font-semibold rounded-2xl hover:from-yellow-500 hover:to-orange-600 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1")
            span Cari Anime
            svg(class="w-5 h-5 ml-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24")
              path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z")

  // Main Content
  div(class="container mx-auto px-4 md:px-6 lg:px-8 py-8")

    div(class="grid grid-cols-1 lg:grid-cols-4 gap-8")
      div(class="lg:col-span-3")
        if ongoingAnime && ongoingAnime.length > 0
          section(class="mb-12")
            div(class="flex items-center justify-between mb-8")
              div(class="flex items-center space-x-3")
                div(class="w-1 h-8 bg-gradient-to-b from-primary-500 to-purple-500 rounded-full")
                h2(class="text-3xl font-bold text-gray-900 dark:text-gray-100") Anime Ongoing Terbaru
              a(href="/ongoing" class="group flex items-center px-4 py-2 bg-white/50 dark:bg-gray-800/50 backdrop-blur-sm border border-gray-200/50 dark:border-gray-700/50 rounded-xl text-primary-600 dark:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-900/20 hover:border-primary-300 dark:hover:border-primary-700 transition-all duration-300 shadow-sm hover:shadow-md")
                span(class="font-medium") Lihat Semua
                svg(class="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                  path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7")
            
            div(class="anime-grid")
             each anime in ongoingAnime.slice(0, 12)
               div(class="anime-card group relative" data-anime-id=anime.id)
                 a(href=`/anime/${anime.slug}` class="block")
                   div(class="relative bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-2xl shadow-lg hover:shadow-2xl dark:shadow-gray-900/50 overflow-hidden transform transition-all duration-500 hover:scale-105 hover:-translate-y-2 border border-gray-200/50 dark:border-gray-700/50")
                     div(class="relative overflow-hidden")
                       img(src=anime.poster alt=anime.title class="w-full h-64 md:h-72 object-cover transition-transform duration-700 group-hover:scale-110" loading="lazy" decoding="async" onerror="this.onerror=null;this.src='https://placehold.co/400x600?text=No+Image';")
                       div(class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500")
                       
                       // Episode Badge
                       if anime.current_episode
                         div(class="absolute top-3 left-3 bg-gradient-to-r from-primary-500 to-purple-500 text-white text-xs font-bold px-3 py-1.5 rounded-full shadow-lg backdrop-blur-sm border border-white/20")= anime.current_episode
                       
                       // Bookmark Button
                       if currentUser
                         button(class="bookmark-btn absolute top-3 right-3 p-2 bg-black/50 backdrop-blur-sm text-white rounded-full hover:bg-black/70 transition-all duration-300 z-10" data-anime-id=anime.id data-anime-title=anime.title data-anime-slug=anime.slug data-anime-poster=anime.poster)
                           svg(class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                             path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z")
                       
                       // Release Date
                       if anime.newest_release_date
                         div(class="absolute bottom-3 right-3 bg-black/70 backdrop-blur-sm text-white text-xs px-2 py-1 rounded-full border border-white/20")= anime.newest_release_date
                       
                       // Hover Overlay
                       div(class="absolute inset-0 bg-gradient-to-t from-black/90 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500")
                       div(class="absolute bottom-0 left-0 right-0 p-4 transform translate-y-full group-hover:translate-y-0 transition-transform duration-500")
                         h3(class="font-bold text-sm text-white line-clamp-2 mb-2 leading-tight")= anime.title
                         if anime.release_day
                           div(class="flex items-center justify-between")
                             span(class="bg-white/20 backdrop-blur-sm text-white px-3 py-1 rounded-full text-xs font-medium")= anime.release_day
                             svg(class="w-4 h-4 text-white/80" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                               path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z")

        if completeAnime && completeAnime.length > 0
          section(class="mb-12")
            div(class="flex items-center justify-between mb-8")
              div(class="flex items-center space-x-3")
                div(class="w-1 h-8 bg-gradient-to-b from-green-500 to-emerald-500 rounded-full")
                h2(class="text-3xl font-bold text-gray-900 dark:text-gray-100") Anime Complete Terbaru
              a(href="/complete" class="group flex items-center px-4 py-2 bg-white/50 dark:bg-gray-800/50 backdrop-blur-sm border border-gray-200/50 dark:border-gray-700/50 rounded-xl text-primary-600 dark:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-900/20 hover:border-primary-300 dark:hover:border-primary-700 transition-all duration-300 shadow-sm hover:shadow-md")
                span(class="font-medium") Lihat Semua
                svg(class="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                  path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7")
            
            div(class="anime-grid")
              each anime in completeAnime.slice(0, 12)
                div(class="anime-card group relative" data-anime-id=anime.id)
                  a(href=`/anime/${anime.slug}` class="block")
                    div(class="relative bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-2xl shadow-lg hover:shadow-2xl dark:shadow-gray-900/50 overflow-hidden transform transition-all duration-500 hover:scale-105 hover:-translate-y-2 border border-gray-200/50 dark:border-gray-700/50")
                      div(class="relative overflow-hidden")
                        img(src=anime.poster alt=anime.title class="w-full h-64 md:h-72 object-cover transition-transform duration-700 group-hover:scale-110" loading="lazy" decoding="async" onerror="this.onerror=null;this.src='https://placehold.co/400x600?text=No+Image';")
                        div(class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500")
                        
                        // Complete Badge
                        div(class="absolute top-3 left-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white text-xs font-bold px-3 py-1.5 rounded-full shadow-lg backdrop-blur-sm border border-white/20") Complete
                        
                        // Bookmark Button
                        if currentUser
                          button(class="bookmark-btn absolute top-3 right-3 p-2 bg-black/50 backdrop-blur-sm text-white rounded-full hover:bg-black/70 transition-all duration-300 z-10" data-anime-id=anime.id data-anime-title=anime.title data-anime-slug=anime.slug data-anime-poster=anime.poster)
                            svg(class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                              path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z")
                        
                        // Rating
                        if anime.rating
                          div(class="absolute bottom-3 right-3 bg-black/70 backdrop-blur-sm text-white text-xs px-2 py-1 rounded-full flex items-center border border-white/20")
                            svg(class="w-3 h-3 mr-1 text-yellow-400" fill="currentColor" viewBox="0 0 20 20")
                              path(d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z")
                            span= anime.rating
                        
                        // Hover Overlay
                        div(class="absolute inset-0 bg-gradient-to-t from-black/90 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500")
                        div(class="absolute bottom-0 left-0 right-0 p-4 transform translate-y-full group-hover:translate-y-0 transition-transform duration-500")
                          h3(class="font-bold text-sm text-white line-clamp-2 mb-2 leading-tight")= anime.title
                          div(class="flex items-center justify-between")
                            span(class="bg-white/20 backdrop-blur-sm text-white px-3 py-1 rounded-full text-xs font-medium") Selesai
                            svg(class="w-4 h-4 text-white/80" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                              path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z")

        if adSlots && adSlots.contentBottom && adSlots.contentBottom.length > 0
          section(class="mb-8")
            each ad in adSlots.contentBottom
              div(class="ad-slot bg-gray-100 dark:bg-gray-800 rounded-2xl shadow-lg transition-colors duration-300")!= ad.content

      div(class="lg:col-span-1")
        if adSlots && adSlots.sidebarTop && adSlots.sidebarTop.length > 0
          div(class="mb-6")
            each ad in adSlots.sidebarTop
              div(class="ad-slot bg-white/50 dark:bg-gray-800/50 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-200/50 dark:border-gray-700/50 transition-all duration-300")!= ad.content

        // Quick Menu
        div(class="bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 mb-6 border border-gray-200/50 dark:border-gray-700/50 transition-all duration-300")
          h3(class="font-bold text-gray-900 dark:text-gray-100 mb-6 flex items-center")
            div(class="w-8 h-8 bg-gradient-to-r from-primary-500 to-purple-500 rounded-lg flex items-center justify-center mr-3")
              svg(class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z")
            span Menu Cepat
          div(class="space-y-2")
            a(href="/ongoing" class="group flex items-center text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-all duration-300 p-3 rounded-xl hover:bg-primary-50 dark:hover:bg-primary-900/20 border border-transparent hover:border-primary-200 dark:hover:border-primary-800")
              div(class="w-8 h-8 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-lg flex items-center justify-center mr-3 group-hover:scale-110 transition-transform duration-300")
                svg(class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                  path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z")
              span(class="font-medium") Anime Ongoing
              svg(class="w-4 h-4 ml-auto opacity-0 group-hover:opacity-100 group-hover:translate-x-1 transition-all duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7")
            
            a(href="/complete" class="group flex items-center text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-all duration-300 p-3 rounded-xl hover:bg-primary-50 dark:hover:bg-primary-900/20 border border-transparent hover:border-primary-200 dark:hover:border-primary-800")
              div(class="w-8 h-8 bg-gradient-to-r from-green-500 to-emerald-500 rounded-lg flex items-center justify-center mr-3 group-hover:scale-110 transition-transform duration-300")
                svg(class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                  path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z")
              span(class="font-medium") Anime Complete
              svg(class="w-4 h-4 ml-auto opacity-0 group-hover:opacity-100 group-hover:translate-x-1 transition-all duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7")
            
            a(href="/genres" class="group flex items-center text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-all duration-300 p-3 rounded-xl hover:bg-primary-50 dark:hover:bg-primary-900/20 border border-transparent hover:border-primary-200 dark:hover:border-primary-800")
              div(class="w-8 h-8 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg flex items-center justify-center mr-3 group-hover:scale-110 transition-transform duration-300")
                svg(class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                  path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.99 1.99 0 013 12V7a4 4 0 014-4z")
              span(class="font-medium") Genre Anime
              svg(class="w-4 h-4 ml-auto opacity-0 group-hover:opacity-100 group-hover:translate-x-1 transition-all duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7")
            
            a(href="/search" class="group flex items-center text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-all duration-300 p-3 rounded-xl hover:bg-primary-50 dark:hover:bg-primary-900/20 border border-transparent hover:border-primary-200 dark:hover:border-primary-800")
              div(class="w-8 h-8 bg-gradient-to-r from-orange-500 to-red-500 rounded-lg flex items-center justify-center mr-3 group-hover:scale-110 transition-transform duration-300")
                svg(class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                  path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z")
              span(class="font-medium") Pencarian Anime
              svg(class="w-4 h-4 ml-auto opacity-0 group-hover:opacity-100 group-hover:translate-x-1 transition-all duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7")

        // Donation Section - Trakteer
        div(class="bg-gradient-to-br from-white/90 to-white/70 dark:from-gray-800/90 dark:to-gray-800/70 backdrop-blur-sm rounded-2xl shadow-lg p-6 mb-6 border border-gray-200/50 dark:border-gray-700/50 transition-all duration-300 hover:shadow-xl hover:scale-[1.02] group")
          h3(class="font-bold text-gray-900 dark:text-gray-100 mb-6 flex items-center group-hover:text-red-600 dark:group-hover:text-red-400 transition-colors duration-300")
            div(class="w-8 h-8 bg-gradient-to-r from-red-500 to-pink-500 rounded-lg flex items-center justify-center mr-3 group-hover:from-red-600 group-hover:to-pink-600 transition-all duration-300")
              svg(class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z")
            span Dukung KitaNime
          div(class="flex flex-col gap-4 items-center w-full")
            p(class="text-gray-600 dark:text-gray-400 text-sm text-center leading-relaxed mb-2") 
              | Bantu kami terus memberikan layanan terbaik dengan donasi melalui Trakteer
            div(class="flex justify-center items-center p-4 bg-gradient-to-r from-white/60 to-white/40 dark:from-gray-700/60 dark:to-gray-700/40 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-200/50 dark:border-gray-700/50 w-full max-w-md hover:shadow-xl hover:shadow-red-200/50 dark:hover:shadow-red-900/30 transition-all duration-300 group/trakteer")
              a(href="https://trakteer.id/kaneki-craynet-zqujz" target="_blank" class="block transform hover:scale-110 transition-transform duration-300 focus:outline-none focus:ring-2 focus:ring-red-500/50 focus:ring-offset-2 dark:focus:ring-offset-gray-800 rounded-lg" aria-label="Donasi melalui Trakteer")
                img(id="wse-buttons-preview" src="https://edge-cdn.trakteer.id/images/embed/trbtn-red-1.png?v=14-05-2025" height="40" style="border:0px;height:40px;" alt="Trakteer Saya" class="rounded-lg shadow-md hover:shadow-lg transition-all duration-300 group-hover/trakteer:shadow-red-200/50")
            p(class="text-xs text-gray-500 dark:text-gray-500 text-center mt-2") 
              | Klik tombol di atas untuk mendukung kami melalui Trakteer
            div(class="flex items-center gap-2 text-xs text-gray-400 dark:text-gray-600")
              svg(class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z")
              span Aman & Terpercaya

        if adSlots && adSlots.sidebarBottom && adSlots.sidebarBottom.length > 0
          div(class="mb-6")
            each ad in adSlots.sidebarBottom
              div(class="ad-slot bg-white/50 dark:bg-gray-800/50 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-200/50 dark:border-gray-700/50 transition-all duration-300")!= ad.content

        // About Section
        div(class="bg-gradient-to-br from-primary-50/80 to-purple-50/80 dark:from-primary-900/50 dark:to-purple-900/50 backdrop-blur-sm rounded-2xl p-6 border border-primary-200/50 dark:border-primary-700/50 transition-all duration-300")
          h3(class="font-bold text-primary-900 dark:text-primary-100 mb-4 flex items-center")
            div(class="w-8 h-8 bg-gradient-to-r from-primary-500 to-purple-500 rounded-lg flex items-center justify-center mr-3")
              svg(class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24")
                path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z")
            span Tentang KitaNime
          p(class="text-primary-800 dark:text-primary-200 text-sm leading-relaxed") Platform streaming anime terlengkap dengan subtitle Indonesia berkualitas tinggi. Nikmati pengalaman menonton anime yang tak terlupakan dengan kualitas HD dan update terbaru setiap hari.

block scripts
  script.
    // Trakteer button interaction enhancement
    document.addEventListener('DOMContentLoaded', function() {
      const trakteerButton = document.querySelector('a[href*="trakteer.id"]');
      if (trakteerButton) {
        trakteerButton.addEventListener('click', function(e) {
          // Add click animation
          this.style.transform = 'scale(0.95)';
          setTimeout(() => {
            this.style.transform = '';
          }, 150);
          
          // Track click event (optional analytics)
          console.log('Trakteer donation button clicked');
        });
        
        // Add keyboard accessibility
        trakteerButton.addEventListener('keydown', function(e) {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            this.click();
          }
        });
      }
    });

    if ('IntersectionObserver' in window) {
      const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            img.src = img.dataset.src;
            img.classList.remove('lazy');
            imageObserver.unobserve(img);
          }
        });
      }, {
        rootMargin: '50px 0px', // Start loading 50px before image comes into view
        threshold: 0.1
      });

      // Use requestIdleCallback for better performance
      if ('requestIdleCallback' in window) {
        requestIdleCallback(() => {
          document.querySelectorAll('img[data-src]').forEach(img => {
            imageObserver.observe(img);
          });
        });
      } else {
        // Fallback for browsers without requestIdleCallback
        setTimeout(() => {
          document.querySelectorAll('img[data-src]').forEach(img => {
            imageObserver.observe(img);
          });
        }, 100);
      }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        document.querySelector(this.getAttribute('href')).scrollIntoView({
          behavior: 'smooth'
        });
      });
    });
